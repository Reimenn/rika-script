# 更新日志

## v0.6 - 2021年6月4日

质的飞跃，大量更新，运行时代码重构

#### 数据类型

RikaScript 中的默认数据类型是 `int` `float` `string`，

可以通过在数字最后加上 `f\d\l`（不区分大小写）来表示 `float\double\long`类型。

字符串类型**必须**加上定界符，单引号双引号都可以，字符串中可以用通配符`\n \t \\ \' \"`

#### 变量操作

使用`set`关键字设置变量：

```js
set message = 'Hello World'
log(message) // Hello World
set num = 10
set num += 5
log(num) // 15
```

注意现在取变量也不需要加上@前缀了，直接写变量名就行了，当然代价就是字符串必须加上定界符了。

#### 运算语句

现在开始，RikaScript 终于支持嵌套函数调用甚至中缀表达式计算语法了：

```js
log(1 + int(10 ** 0.5)) // INFO 4，先把10算平方根，取整，再加 1
```

#### 控制语句

原有的`func`定义过程功能没有更改，但通过语法糖的形式简化了`if` `while`语句的使用：

```python
set i = 0
while i <= 10{
	if i % 2 == 0{
    	log(i,'是个偶数') // 输出偶数了！
    }
    set i += 1
}
```

#### 基于字符串定义的变量名

其实上面的 `set` 语句就是个语法糖，`set a = 1` 会被翻译成 `'a' = 1`，所以如果不嫌奇怪可以直接把赋值号的左边换成字符串。等以后字符串类库完善之后就可以通过字符串类库的各种操作取各个变量了。

之所以这么奇怪，其实就是因为 RikaScript 底层使用了一个`Dictionary<string, object>`存储数据。

#### 注释

RikaScript 的注释使用 `//` 表示，但目前为了性能考虑，实现的还是有些问题，目前只能在纯表达式行末尾使用注释，不能在 `if` `while` `func` 开头的行后使用注释。因为忽略注释是在底层 Runtime 实现的，Engine 不能处理注释。

#### 语法格式

RikaScript 是一个依靠简单算法实现的脚本语言，没有词法分析或编译过程，因此在语法上，要求可能让人感到死板：

1. `if` `while` `func` 需要定义代码块的代码，其后的`{`符号必须在这一行最后，不能单独一行。
2. 结束代码块的`}`符号，必须单独一行，前后除了空字符不能有其他东西。
3. 由于 RikaScript 没有`运算符`这种概念，一切二元中缀表达式都是通过语法糖转换成方法调用实现，所以每个运算符两侧都需要留出空格，例如：`1 + 1`是正确的，而这样是**错误**的：`1+1`，这样写会认为这几个字符是一个整体。
4. RikaScript 中充满惊喜，喜欢你的 bug 们都想和你见面。

#### 其他更新

太多了，不细说了……

## v0.5 没有发布，内容集成在 v0.6 中

修改类库加载方式、函数存储方式，类库管理代码重构

#### 更新内容

1. 从现在开始，实现类库时不需要再到构造方法中填写参数了，只要继承了 `ScriptLibBase` 类，即可把当前类当做类库使用。同时建议给这个类加上 `Library` 特征标签来指定类库默认名称和版本：

```c#
[Library("test","v2.33","这里可以写这个类库的帮助信息")]
public class Test : ScriptLibBase{
}
```

2. 同时，函数生命也改成了同样的方式，只有打上 `Method` 特征标签的方法，才能被 RikaScript 调用：
```c#
[Method(Name = "hello",Help = "打个招呼")]
public void Hello(object name){
	Runtime.Logger.Info("Hello " + name);
}
// RS 调用：hello("rika")
```

3. 因为在上述两个特征标签中实现了 Help 字段，所以不用再手动添加帮助了，`ScriptLibBase` 父类中实现了 help 方法用于显示全部或搜索帮助信息。
4. 预缓存的方法不再存放在每个类库自身内，而是存在了 `Runtime` 里面，每个方法会尽量存两份。key 分别是纯方法名加参数数量，比如 `hello^1`，或类库+方法名+参数，如：`test.hello^1`。
5. 如果 `Method` 特征标签里声明了 `Keep = true`，则导入类库后，不带类库前缀的方法无法被后续导入覆盖。
6. 标准库中的方法全部加上了`Kepp = true`，它们是不能被覆盖的


## v0.4.1 - 2021年5月29日

更新内容，增加了两个文件

## v0.4 - 2021年5月22日

#### 更新内容

1. 类库的帮助信息不再是一个字符串，而是单独做成了一个 LibInfo 类。
   2. 	这个类可以更规范的为类库提供帮助信息并提供信息检索功能。
   2. 在类库的构造方法中调用父类属性 `Info` 即可获取 LibInfo 实例，调用 `Info.AddInfo` 添加帮助信息即可。
   3. 使用 `std.help(类型)` 这样的语法在 std 类库中搜索与“类型”有关的信息
2. 为 RikaScript 尝鲜程序添加了输入提示符：`RS > `
3. 增加了 help 命令，显示当前默认类库的全部帮助信息
4. `if @var return` 语法不仅可以跳出当前执行的方法，还能跳出当前通过 `exec` 执行的文件 
5. 修改了类库基类的构造方法，现在强制给类库设置默认别名，并且需要类库加上版本号信息
6. 更多注释

#### 兼容性

1. 因为添加了 LibInfo 类，所以自定义的类库不再需要重写 help 方法了，当然重写了也无所谓，只是LibInfo会不起效而已。
2. 因为类库基类构造方法改了，所以类库的构造方法也要小改一下
3. 因为 `if @var return` 的语法扩展了一点点，可能会稍微影响以前的程序